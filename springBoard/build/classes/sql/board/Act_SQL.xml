<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="In.Act">

	<sql id="In.Act.listQry">
		SELECT A.APP_NO
		      ,A.ANN_NO
		      ,C.OPER_ORG
			  ,(SELECT CD_NM FROM TB_CO_CODE WHERE CO_CD = C.OPER_ORG) AS OPER_ORG_NM
			  ,C.BIZ_YEAR
			  ,C.BIZNM
			  ,A.APPLCNT_ID
			  ,B.APPLCNT_NM
			  ,DECODE(B.GENDER,'M','남','여') AS GENDER
			  ,B.BIRTHDE_YEAR
			  ,B.BIRTHDE_MT
			  ,B.BIRTHDE_DD
			  ,B.HP_1
			  ,B.HP_2
			  ,ECL_DECRYPT(B.HP_3) AS HP_3
			  ,B.EMAIL
			  ,B.ZIPCODE
			  ,A.ACT_ING_STEP
			  ,(SELECT CD_NM FROM TB_CO_CODE WHERE CO_CD = A.ACT_ING_STEP) AS  ACT_ING_STEP_NM
			  ,E.ACTCOMP_NM
			  ,F.ACCYYYYMM
			  ,F.MT_REG_ACT_TM
			  ,F.MT_REG_ACT_DAY
			  ,F.MT_ADMIT_ACT_TM
			  ,F.MT_ADMIT_ACT_DAY
			  ,SUBSTR(NVL(F.MT_REG_ACT_TM,'00000'),0,3) || '시간' AS MT_REG_ACT_TM_HH
			  ,SUBSTR(NVL(F.MT_REG_ACT_TM,'00000'),4,2) || '분' AS MT_REG_ACT_TM_MI
			  ,NVL(F.MT_REG_ACT_DAY,'0') || '일' AS MT_REG_ACT_DAY_NM
			  ,SUBSTR(NVL(F.MT_ADMIT_ACT_TM,'00000'),0,3) || '시간'  AS MT_ADMIT_ACT_TM_HH
			  ,SUBSTR(NVL(F.MT_ADMIT_ACT_TM,'00000'),4,2) || '분'  AS MT_ADMIT_ACT_TM_MI
			  ,NVL(F.MT_ADMIT_ACT_DAY,'0') || '일' AS MT_ADMIT_ACT_DAY_NM
			  ,(SELECT MEMBER_NM FROM TB_CO_MEMBER WHERE MEMBER_NO = F.CHG_ID) AS CHG_ID
			  ,TO_CHAR(F.CHG_DT,'YYYY-MM-DD') AS CHG_DT
			  ,(SELECT COUNT(1) FROM TB_IN_ACTJNL WHERE SUBSTR(ACT_DE,0,6) = F.ACCYYYYMM AND DAILDOC_APPRV_STAT = 'IN38001' AND APP_NO = A.APP_NO AND USE_YN = 'Y') AS IN38001
			  ,(SELECT COUNT(1) FROM TB_IN_ACTJNL WHERE SUBSTR(ACT_DE,0,6) = F.ACCYYYYMM AND DAILDOC_APPRV_STAT = 'IN38002' AND APP_NO = A.APP_NO AND USE_YN = 'Y') AS IN38002
			  ,(SELECT COUNT(1) FROM TB_IN_ACTJNL WHERE SUBSTR(ACT_DE,0,6) = F.ACCYYYYMM AND DAILDOC_CFM_STAT = 'IN30001' AND APP_NO = A.APP_NO AND USE_YN = 'Y') AS IN30001
			  ,(SELECT COUNT(1) FROM TB_IN_ACTJNL WHERE SUBSTR(ACT_DE,0,6) = F.ACCYYYYMM AND DAILDOC_CFM_STAT = 'IN30002' AND APP_NO = A.APP_NO AND USE_YN = 'Y') AS IN30002
			  ,(SELECT COUNT(1) FROM TB_IN_ACTJNL WHERE SUBSTR(ACT_DE,0,6) = F.ACCYYYYMM AND DAILDOC_CFM_STAT = 'IN30003' AND APP_NO = A.APP_NO AND USE_YN = 'Y') AS IN30003
			  ,D.USE_YN
			  ,D.ACTCOMP_NO
		  FROM TB_IN_APP A
		      ,TB_IN_APPINFO B
		      ,TB_IN_RECANN C
		      ,TB_IN_ACTCOMPJOIN D
		      ,TB_IN_ACTCOMP E
		      ,(SELECT A.APP_NO
				      ,A.ACCYYYYMM
				      ,A.MT_REG_ACT_TM
				      ,A.MT_REG_ACT_DAY
				      ,A.MT_ADMIT_ACT_TM
				      ,A.MT_ADMIT_ACT_DAY
				      ,B.ACTCOMP_NO
				      ,A.CHG_ID
				      ,A.CHG_DT
				  FROM TB_IN_ACTJNLMONTH A
				      ,(SELECT APP_NO
				             ,SUBSTR(ACT_DE,0,6) AS ACCYYYYMM
				             ,ACTCOMP_NO
				         FROM TB_IN_ACTJNL
				         GROUP BY APP_NO,SUBSTR(ACT_DE,0,6),ACTCOMP_NO) B
				 WHERE A.APP_NO = B.APP_NO
				   AND A.ACCYYYYMM = B.ACCYYYYMM) F
		 WHERE A.APP_NO = B.APP_NO
		   AND A.ANN_NO = C.ANN_NO
		   AND A.APPLCNT_ID = D.APPLCNT_ID
		   AND D.ACTCOMP_NO = E.ACTCOMP_NO
		   AND E.ACTCOMP_NO = F.ACTCOMP_NO
		   AND A.APP_NO = F.APP_NO
		   AND F.ACCYYYYMM = #SRCH_YEAR# || #SRCH_MONTH#
		   AND A.ACT_ING_STEP IN ('IN29002','IN29003','IN29004','IN29005')
	</sql>
	
	<sql id="In.Act.listWhere">
		<isNotEmpty property="IS_IN_ADMIN">
		AND A.ANN_NO IN (SELECT ANN_NO FROM TB_IN_SETADMIN WHERE ADM_ID = #ADM_ID#)
		</isNotEmpty>
		<isNotEmpty property="IS_IN_RES">
		AND E.ACTCOMP_NO IN (SELECT ACTCOMP_NO FROM TB_IN_ACTCOMPRES WHERE CHARGR_ID = #ADM_ID#)
		</isNotEmpty>
		<isNotEmpty property="SRCH_BIZ_YEAR">
		AND C.BIZ_YEAR = #SRCH_BIZ_YEAR#
		</isNotEmpty>
		<isNotEmpty property="SRCH_BIZNM">
		AND (INSTR(UPPER(C.BIZNM),UPPER(#SRCH_BIZNM#)) <![CDATA[ > ]]> 0 
		 OR INSTR(UPPER(E.ACTCOMP_NM),UPPER(#SRCH_BIZNM#)) <![CDATA[ > ]]> 0)
		</isNotEmpty>
		<isNotEmpty property="SRCH_APPLICANT_NM">
		AND INSTR(UPPER(B.APPLCNT_NM),UPPER(#SRCH_APPLICANT_NM#)) >  0
		</isNotEmpty>
		<isNotEmpty property="SRCH_BIRTHDE">
		AND B.BIRTHDE_YEAR || B.BIRTHDE_MT || B.BIRTHDE_DD = REPLACE(#SRCH_BIRTHDE#,'-','')
		</isNotEmpty>
		<isNotEmpty property="SRCH_ACT_ING_STEP">
		AND A.ACT_ING_STEP = #SRCH_ACT_ING_STEP#
		</isNotEmpty>
		<isNotEmpty property="SRCH_ACTCOMP_NM">
		AND INSTR(UPPER(E.ACTCOMP_NM),UPPER(#SRCH_ACTCOMP_NM#)) <![CDATA[ > ]]> 0
		</isNotEmpty>
		<isNotEmpty property="SRCH_ADMIT_ACT_DAY_ST">
		AND TO_NUMBER(F.MT_ADMIT_ACT_DAY) <![CDATA[>=]]> TO_NUMBER(#SRCH_ADMIT_ACT_DAY_ST#)
		</isNotEmpty>
		<isNotEmpty property="SRCH_ADMIT_ACT_DAY_ED">
		AND TO_NUMBER(F.MT_ADMIT_ACT_DAY) <![CDATA[<=]]> TO_NUMBER(#SRCH_ADMIT_ACT_DAY_ED#)
		</isNotEmpty>
		<isNotEmpty property="SRCH_ADMIT_ACT_ST_TM">
		AND TO_NUMBER(F.MT_ADMIT_ACT_TM) <![CDATA[>=]]> TO_NUMBER(NVL(#SRCH_ADMIT_ACT_ST_TM#,'00') || NVL(#SRCH_ADMIT_ACT_ST_MI#,'00'))
		</isNotEmpty>
		<isNotEmpty property="SRCH_ADMIT_ACT_ED_TM">
		AND TO_NUMBER(F.MT_ADMIT_ACT_TM) <![CDATA[<=]]> TO_NUMBER(NVL(#SRCH_ADMIT_ACT_ED_TM#,'00') || NVL(#SRCH_ADMIT_ACT_ED_MI#,'00'))
		</isNotEmpty>
		<isNotEmpty property="MDSRCH_BIZ_YEAR">
		AND C.BIZ_YEAR = #MDSRCH_BIZ_YEAR#
		</isNotEmpty>
		<isNotEmpty property="MDSRCH_ANN_NO">
		AND C.ANN_NO = #MDSRCH_ANN_NO#
		</isNotEmpty>
		<isNotEmpty property="MDSRCH_ACTCOMPNO">
		AND E.ACTCOMP_NO = #MDSRCH_ACTCOMPNO#
		</isNotEmpty>
	</sql>
	
	<sql id="In.Act.listOrder">	
		ORDER BY B.APPLCNT_NM ASC
   	</sql>

   	<select id="In.Act.listCnt" parameterClass="boxMap" resultClass="java.lang.Integer">
		/* In.Act.listCnt */
		<include refid="paging.cnt.start"/>
		<include refid="In.Act.listQry"/>
		<include refid="In.Act.listWhere"/>
	    <include refid="paging.cnt.end"/>
	</select>
	
	<select id="In.Act.list" parameterClass="boxMap" resultClass="boxMap">
		/* In.Act.list */
		<include refid="paging.query.start"/>
		<include refid="In.Act.listQry"/>
		<include refid="In.Act.listWhere"/>
		<include refid="In.Act.listOrder"/>
    	<include refid="paging.query.end"/>
	</select>
	
	<select id="In.Act.excel" parameterClass="boxMap" resultClass="boxMap">
		/* In.Act.excel */
		<include refid="In.Act.listQry"/>
		<include refid="In.Act.listWhere"/>
		<include refid="In.Act.listOrder"/>
	</select>

	<insert id="In.Act.insertHist" parameterClass="boxMap">
	INSERT INTO TB_IN_APPHIST (APP_NO,SEQ,PRE_STAT,CUR_STAT,CHG_RSN,REG_ID,REG_DT,CHG_ID,CHG_DT)
	VALUES (#APP_NO#,TB_IN_APPHIST_SEQ.NEXTVAL,(SELECT ACT_ING_STEP FROM TB_IN_APP WHERE APP_NO = #APP_NO#),#ACT_ING_STEP#,'참여자활동현황에서변경',#REG_ID#,SYSDATE,#CHG_ID#,SYSDATE)
	</insert>
	
	<update id="In.Act.change" parameterClass="boxMap">
	UPDATE TB_IN_APP
	   SET ACT_ING_STEP = #ACT_ING_STEP#
	      ,CHG_ID = #CHG_ID#
	      ,CHG_DT = SYSDATE
	 WHERE APP_NO = #APP_NO#
	</update>
	
	<select id="In.Act.monthView" parameterClass="boxMap" resultClass="boxMap">
		/* In.Act.monthView */
		SELECT A.APP_NO
		      ,C.BIZNM
		      ,A.APPLCNT_ID
		      ,B.APPLCNT_NM
		      ,B.BIRTHDE_YEAR
			  ,B.BIRTHDE_MT
			  ,B.BIRTHDE_DD
			  ,B.HP_1
			  ,B.HP_2
			  ,ECL_DECRYPT(B.HP_3) AS HP_3
			  ,D.MT_REG_ACT_TM
			  ,D.MT_ADMIT_ACT_TM
			  ,(SELECT CD_NM FROM TB_CO_CODE WHERE CO_CD = A.ACT_ING_STEP) AS  ACT_ING_STEP_NM
			  ,SUBSTR(NVL(D.MT_REG_ACT_TM,'00000'),0,3) AS MT_REG_ACT_TM_HH
			  ,SUBSTR(NVL(D.MT_REG_ACT_TM,'00000'),4,2) AS MT_REG_ACT_TM_MI
			  ,NVL(D.MT_REG_ACT_DAY,'0') AS MT_REG_ACT_DAY_NM
			  ,SUBSTR(NVL(D.MT_ADMIT_ACT_TM,'00000'),0,3) AS MT_ADMIT_ACT_TM_HH
			  ,SUBSTR(NVL(D.MT_ADMIT_ACT_TM,'00000'),4,2) AS MT_ADMIT_ACT_TM_MI
			  ,NVL(D.MT_ADMIT_ACT_DAY,'0') AS MT_ADMIT_ACT_DAY_NM
			  ,SUBSTR(NVL(D.MT_CFM_ACT_TM,'00000'),0,3) AS MT_CFM_ACT_TM_HH
			  ,SUBSTR(NVL(D.MT_CFM_ACT_TM,'00000'),4,2) AS MT_CFM_ACT_TM_MI
			  ,NVL(D.MT_CFM_ACT_DAY,'0') AS MT_CFM_ACT_DAY_NM
		  FROM TB_IN_APP A
		      ,TB_IN_APPINFO B
		      ,TB_IN_RECANN C
		      ,TB_IN_ACTJNLMONTH D 
		 WHERE A.APP_NO = B.APP_NO
		   AND A.ANN_NO = C.ANN_NO
		   AND A.APP_NO = D.APP_NO
		   AND A.APP_NO = #APP_NO# 
		   AND D.ACCYYYYMM =  #SRCH_YEAR# || #SRCH_MONTH#
		   AND D.ACTCOMP_NO = #ACTCOMP_NO#
	</select>
	
	<select id="In.Act.listJnl" parameterClass="boxMap" resultClass="boxMap">
	/* In.Act.listJnl */
	SELECT SEQ
		  ,ACT_SE
		  ,(SELECT CD_NM FROM TB_CO_CODE WHERE CO_CD = A.ACT_SE) AS ACT_SE_VIEW
		  ,ACT_SJ
		  ,ACT_STTM
		  ,ACT_EDTM
		  ,ACT_TM
		  ,ADMIT_ACT_TM
		  ,SUBSTR(NVL(ACT_STTM,0000),0,2) AS ACT_STTM_HH
		  ,SUBSTR(NVL(ACT_STTM,0000),3,2) AS ACT_STTM_MI
		  ,SUBSTR(NVL(ACT_EDTM,0000),0,2) AS ACT_EDTM_HH
		  ,SUBSTR(NVL(ACT_EDTM,0000),3,2) AS ACT_EDTM_MI
		  ,SUBSTR(NVL(ACT_TM,0000),0,2) AS ACT_TM_HH
		  ,SUBSTR(NVL(ACT_TM,0000),3,2) AS ACT_TM_MI
		  ,SUBSTR(NVL(ADMIT_ACT_TM,0000),0,2) AS ADMIT_ACT_TM_HH
		  ,SUBSTR(NVL(ADMIT_ACT_TM,0000),3,2) AS ADMIT_ACT_TM_MI
		  ,ACT_DE
		  ,TO_CHAR(TO_DATE(ACT_DE),'YYYY-MM-DD') AS ACT_DE_VIEW
		  ,LUNCH_CD
		  ,DINNER_CD
		  ,(SELECT DECODE(A.LUNCH_CD,'IN15002','-',CD_NM) FROM TB_CO_CODE WHERE CO_CD = A.LUNCH_CD) AS LUNCH_CD_VIEW
		  ,(SELECT DECODE(A.DINNER_CD,'IN16002','-',CD_NM) FROM TB_CO_CODE WHERE CO_CD = A.DINNER_CD) AS DINNER_CD_VIEW
		  ,(SELECT CD_NM FROM TB_CO_CODE WHERE CO_CD = A.WORK_SE) AS WORK_SE_VIEW
		  ,DECODE(WORK_SE,'IN39001','일반','IN39002','시간외','IN39003','시간외','IN39004','시간외','IN39005','일반','IN39006','일반') AS WORK_SE_LIST
		  ,NOTE
		  ,DAILDOC_APPRV_STAT
		  ,DAILDOC_APPRV_DT
		  ,DAILDOC_APPROVER_ID
		  ,DAILDOC_CFM_STAT
		  ,DAILDOC_CFM_DT
		  ,DAILDOC_CFM_ID
		  ,(SELECT CD_NM FROM TB_CO_CODE WHERE CO_CD = A.DAILDOC_APPRV_STAT) AS DAILDOC_APPRV_STAT_VIEW
		  ,TO_CHAR(TO_DATE(DAILDOC_APPRV_DT),'YYYY-MM-DD') AS DAILDOC_APPRV_DT_VIEW
		  ,(SELECT MEMBER_NM FROM TB_CO_MEMBER WHERE MEMBER_NO = A.DAILDOC_APPROVER_ID) AS DAILDOC_APPROVER_NM
		  ,(SELECT CD_NM FROM TB_CO_CODE WHERE CO_CD = A.DAILDOC_CFM_STAT) AS DAILDOC_CFM_STAT_VIEW
		  ,TO_CHAR(TO_DATE(DAILDOC_CFM_DT),'YYYY-MM-DD') AS DAILDOC_CFM_DT_VIEW
		  ,(SELECT MEMBER_NM FROM TB_CO_MEMBER WHERE MEMBER_NO = A.DAILDOC_CFM_ID) AS DAILDOC_CFM_NM
		  ,USE_YN
		  ,CHG_ID
		  ,CHG_DT 
		  ,ACTCOMP_NO
	  FROM TB_IN_ACTJNL A 
	 WHERE APP_NO = #APP_NO# 
	   AND ACTCOMP_NO = #ACTCOMP_NO#
	   AND SUBSTR(ACT_DE,0,6) = #SRCH_YEAR# || #SRCH_MONTH#
	   	<isNotEmpty property="SEQ">
		AND SEQ = #SEQ#
		</isNotEmpty>
    ORDER BY A.ACT_DE,A.ACT_STTM ASC
	</select>
	
	<select id="In.Act.listJnlExcel" parameterClass="boxMap" resultClass="boxMap">
	/* In.Act.listJnlExcel */
	SELECT SEQ
		  ,ACT_SE
		  ,(SELECT CD_NM FROM TB_CO_CODE WHERE CO_CD = A.ACT_SE) AS ACT_SE_VIEW
		  ,ACT_SJ
		  ,ACT_STTM
		  ,ACT_EDTM
		  ,ACT_TM
		  ,ADMIT_ACT_TM
		  ,SUBSTR(NVL(ACT_STTM,0000),0,2) AS ACT_STTM_HH
		  ,SUBSTR(NVL(ACT_STTM,0000),3,2) AS ACT_STTM_MI
		  ,SUBSTR(NVL(ACT_EDTM,0000),0,2) AS ACT_EDTM_HH
		  ,SUBSTR(NVL(ACT_EDTM,0000),3,2) AS ACT_EDTM_MI
		  ,SUBSTR(NVL(ACT_TM,0000),0,2) AS ACT_TM_HH
		  ,SUBSTR(NVL(ACT_TM,0000),3,2) AS ACT_TM_MI
		  ,SUBSTR(NVL(ADMIT_ACT_TM,0000),0,2) AS ADMIT_ACT_TM_HH
		  ,SUBSTR(NVL(ADMIT_ACT_TM,0000),3,2) AS ADMIT_ACT_TM_MI
		  ,ACT_DE
		  ,TO_CHAR(TO_DATE(ACT_DE),'YYYY-MM-DD') AS ACT_DE_VIEW
		  ,LUNCH_CD
		  ,DINNER_CD
		  ,(SELECT DECODE(A.LUNCH_CD,'IN15002','-',CD_NM) FROM TB_CO_CODE WHERE CO_CD = A.LUNCH_CD) AS LUNCH_CD_VIEW
		  ,(SELECT DECODE(A.DINNER_CD,'IN16002','-',CD_NM) FROM TB_CO_CODE WHERE CO_CD = A.DINNER_CD) AS DINNER_CD_VIEW
		  ,(SELECT CD_NM FROM TB_CO_CODE WHERE CO_CD = A.WORK_SE) AS WORK_SE_VIEW
		  ,DECODE(WORK_SE,'IN39001','일반','IN39002','시간외','IN39003','시간외','IN39004','시간외','IN39005','일반','IN39006','일반') AS WORK_SE_LIST
		  ,NOTE
		  ,DAILDOC_APPRV_STAT
		  ,DAILDOC_APPRV_DT
		  ,DAILDOC_APPROVER_ID
		  ,DAILDOC_CFM_STAT
		  ,DAILDOC_CFM_DT
		  ,DAILDOC_CFM_ID
		  ,(SELECT CD_NM FROM TB_CO_CODE WHERE CO_CD = A.DAILDOC_APPRV_STAT) AS DAILDOC_APPRV_STAT_VIEW
		  ,TO_CHAR(TO_DATE(DAILDOC_APPRV_DT),'YYYY-MM-DD') AS DAILDOC_APPRV_DT_VIEW
		  ,(SELECT MEMBER_NM FROM TB_CO_MEMBER WHERE MEMBER_NO = A.DAILDOC_APPROVER_ID) AS DAILDOC_APPROVER_NM
		  ,(SELECT CD_NM FROM TB_CO_CODE WHERE CO_CD = A.DAILDOC_CFM_STAT) AS DAILDOC_CFM_STAT_VIEW
		  ,TO_CHAR(TO_DATE(DAILDOC_CFM_DT),'YYYY-MM-DD') AS DAILDOC_CFM_DT_VIEW
		  ,(SELECT MEMBER_NM FROM TB_CO_MEMBER WHERE MEMBER_NO = A.DAILDOC_CFM_ID) AS DAILDOC_CFM_NM
		  ,USE_YN
		  ,CHG_ID
		  ,CHG_DT 
		  ,ACTCOMP_NO
	  FROM TB_IN_ACTJNL A 
	 WHERE APP_NO = #APP_NO# 
	   AND ACTCOMP_NO = #ACTCOMP_NO#
	   AND SUBSTR(ACT_DE,0,6) = #SRCH_YEAR# || #SRCH_MONTH#
	   	<isNotEmpty property="SEQ">
		AND SEQ = #SEQ#
		</isNotEmpty>
	   AND USE_YN = 'Y'
    ORDER BY A.ACT_DE,A.ACT_STTM ASC
	</select>
	
	<select id="In.Act.editJnl" parameterClass="boxMap" resultClass="boxMap">
	SELECT APP_NO
	      ,SEQ
	      ,ACT_SE
	      ,ACT_SJ
	      ,ACT_DE
	      ,TO_CHAR(TO_DATE(ACT_DE),'YYYY-MM-DD') AS ACT_DE_VIEW
	      ,ACT_STTM
	      ,SUBSTR(ACT_STTM,0,2) AS ACT_STTM_HH
	      ,SUBSTR(ACT_STTM,3,2) AS ACT_STTM_MM
	      ,ACT_EDTM
	      ,SUBSTR(ACT_EDTM,0,2) AS ACT_EDTM_HH
	      ,SUBSTR(ACT_EDTM,3,2) AS ACT_EDTM_MM
	      ,ACT_TM
	      ,SUBSTR(ACT_TM,0,2) || '시간 ' || SUBSTR(ACT_TM,3,2) || '분' AS ACT_TM_VIEW
	      ,SUBSTR(ACT_TM,0,2) || SUBSTR(ACT_TM,3,2) AS ACT_TM_VIEW2
	      ,LUNCH_CD
	      ,DINNER_CD
	      ,WORK_SE
	      ,ADMIT_ACT_TM
	      ,NVL(SUBSTR(ADMIT_ACT_TM,0,2),SUBSTR(ACT_TM,0,2)) AS ADMIT_ACT_TM_HH
	      ,NVL(SUBSTR(ADMIT_ACT_TM,3,2),SUBSTR(ACT_TM,3,2)) AS ADMIT_ACT_TM_MM
	      ,NOTE
	      ,DAILDOC_CFM_STAT
	      ,DAILDOC_APPRV_STAT
	 FROM TB_IN_ACTJNL
	WHERE SEQ = #SEQ#
	</select>
	
	<select id="In.Act.checkTm" parameterClass="boxMap" resultClass="java.lang.String">
	SELECT MT_ACT_ADMIT_TM FROM TB_IN_RECANN WHERE ANN_NO IN (SELECT ANN_NO FROM TB_IN_APP WHERE APP_NO = #APP_NO#)
	</select>
	
	<insert id="In.Act.insertHistJnl" parameterClass="boxMap">
	INSERT INTO TB_IN_ACTJNLHIST(HIST_SEQ,APP_NO,ACT_SE,ACT_SJ,ACT_STTM,ACT_EDTM,ACT_TM,ADMIT_ACT_TM,ACT_DE,LUNCH_CD,DINNER_CD,WORK_SE,NOTE,DAILDOC_APPRV_STAT,DAILDOC_APPRV_DT,DAILDOC_APPROVER_ID,DAILDOC_CFM_STAT,DAILDOC_CFM_DT,DAILDOC_CFM_ID,USE_YN,REG_ID,REG_DT,CHG_ID,CHG_DT)  
    (SELECT TB_IN_ACTJNLHIST_SEQ.NEXTVAL,APP_NO,ACT_SE,ACT_SJ,ACT_STTM,ACT_EDTM,ACT_TM,ADMIT_ACT_TM,ACT_DE,LUNCH_CD,DINNER_CD,WORK_SE,NOTE,DAILDOC_APPRV_STAT,DAILDOC_APPRV_DT,DAILDOC_APPROVER_ID,DAILDOC_CFM_STAT,DAILDOC_CFM_DT,DAILDOC_CFM_ID,USE_YN,#REG_ID#,SYSDATE,#CHG_ID#,SYSDATE FROM TB_IN_ACTJNL WHERE SEQ = #SEQ#)
	</insert>

	<delete id="In.Act.deleteJnl" parameterClass="boxMap" >
	UPDATE TB_IN_ACTJNL 
	   SET USE_YN = 'N'
	      ,CHG_ID = #CHG_ID#
	      ,CHG_DT = SYSDATE
	 WHERE SEQ = #SEQ#
	</delete>
	
	<delete id="In.Act.decideJnl" parameterClass="boxMap" >
	UPDATE TB_IN_ACTJNL 
	   SET DAILDOC_CFM_STAT = 'IN30001'
	      ,DAILDOC_CFM_DT = SYSDATE
	      ,DAILDOC_CFM_ID = #CHG_ID#
	      ,ADMIT_ACT_TM = DECODE(ADMIT_ACT_TM,NULL,ACT_TM,ADMIT_ACT_TM)
	      ,CHG_ID = #CHG_ID#
	      ,CHG_DT = SYSDATE
	 WHERE SEQ = #SEQ#
	</delete>
	
	<update id="In.Act.updateCfmJnl" parameterClass="boxMap">
	UPDATE TB_IN_ACTJNL
	  SET ACT_SE = #ACT_SE#
	     ,ACT_SJ = #ACT_SJ#
	     ,ACT_DE = REPLACE(#ACT_DE#,'-','')
	     ,ACT_STTM = #ACT_STTM#
	     ,ACT_EDTM = #ACT_EDTM#
	     ,ACT_TM = #ACT_TM#
	     ,LUNCH_CD = #LUNCH_CD#
	     ,DINNER_CD = #DINNER_CD#
	     ,WORK_SE = #WORK_SE#
	     ,ADMIT_ACT_TM = #ADMIT_ACT_TM#
	     ,NOTE = #NOTE#
	     ,DAILDOC_CFM_STAT = #DAILDOC_CFM_STAT#
	     <isEqual property="DAILDOC_CFM_STAT" compareValue="IN30001">
	     ,DAILDOC_CFM_DT = SYSDATE
	     ,DAILDOC_CFM_ID = #CHG_ID#
	     </isEqual>
	     ,CHG_ID = #CHG_ID#
	     ,CHG_DT = SYSDATE 
	 WHERE SEQ = #SEQ#
	</update>
	
	<update id="In.Act.updateRegJnl" parameterClass="boxMap">
	UPDATE TB_IN_ACTJNL
	  SET ACT_SE = #ACT_SE#
	     ,ACT_SJ = #ACT_SJ#
	     ,ACT_DE = REPLACE(#ACT_DE#,'-','')
	     ,ACT_STTM = #ACT_STTM#
	     ,ACT_EDTM = #ACT_EDTM#
	     ,ACT_TM = #ACT_TM#
	     ,LUNCH_CD = #LUNCH_CD#
	     ,DINNER_CD = #DINNER_CD#
	     ,WORK_SE = #WORK_SE#
	     ,ADMIT_ACT_TM = #ADMIT_ACT_TM#
	     ,NOTE = #NOTE#
	     ,DAILDOC_APPRV_STAT = #DAILDOC_APPRV_STAT#
	     <isEqual property="DAILDOC_APPRV_STAT" compareValue="IN38001">
	     ,DAILDOC_APPRV_DT = SYSDATE
	     ,DAILDOC_APPROVER_ID = #CHG_ID#
	     ,DAILDOC_CFM_STAT = 'IN30003'
	     </isEqual>
	     ,CHG_ID = #CHG_ID#
	     ,CHG_DT = SYSDATE
	 WHERE SEQ = #SEQ#
	</update>
	
	<update id="In.Act.updateMonth" parameterClass="boxMap">
	UPDATE TB_IN_ACTJNLMONTH A
	   SET MT_REG_ACT_TM = FN_IN_SUMTM(#APP_NO#,#SRCH_YEAR# || #SRCH_MONTH#,'ACT')
	      ,MT_REG_ACT_DAY = (SELECT COUNT(1) FROM (SELECT ACT_DE FROM TB_IN_ACTJNL  WHERE APP_NO = #APP_NO# AND SUBSTR(ACT_DE,0,6) = #SRCH_YEAR# || #SRCH_MONTH# AND USE_YN = 'Y' GROUP BY ACT_DE))
	      ,MT_ADMIT_ACT_TM = FN_IN_SUMTM(#APP_NO#,#SRCH_YEAR# || #SRCH_MONTH#,'ADMIT')
	      ,MT_ADMIT_ACT_DAY = (SELECT COUNT(1) FROM (SELECT ACT_DE FROM TB_IN_ACTJNL  WHERE APP_NO = #APP_NO# AND SUBSTR(ACT_DE,0,6) = #SRCH_YEAR# || #SRCH_MONTH# AND USE_YN = 'Y' GROUP BY ACT_DE))
	      ,MT_CFM_ACT_TM = FN_IN_SUMTM(#APP_NO#,#SRCH_YEAR# || #SRCH_MONTH#,'CFM')
	      ,MT_CFM_ACT_DAY = (SELECT COUNT(1) FROM (SELECT ACT_DE FROM TB_IN_ACTJNL  WHERE APP_NO = #APP_NO# AND SUBSTR(ACT_DE,0,6) = #SRCH_YEAR# || #SRCH_MONTH# AND USE_YN = 'Y' AND DAILDOC_CFM_STAT = 'IN30001' GROUP BY ACT_DE))
	      ,CHG_ID = #CHG_ID#
	      ,CHG_DT = SYSDATE
	  WHERE APP_NO = #APP_NO#
	    AND ACCYYYYMM = #SRCH_YEAR# || #SRCH_MONTH#
	</update>

</sqlMap>
